constants: &constants
  daily_points_limit: &daily_points_limit 50000
  weekly_points_limit: &weekly_points_limit 100000
  monthly_points_limit: &monthly_points_limit 200000
  zero_turn_based_reward_probability: &zero_turn_based_reward_probability 0.25

amount_rules:
  - name: high
    priority: 300
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: turn_quality_score
          operator: greater_than_or_equal_to
          value: 7
    min_value: 80
    max_value: 99
    mean_value: 85
    high_min_value: 1000
    high_max_value: 10000
    high_mean_value: 4000
    comments:
      - "Nice prompt."
      - "Great conversation starter."
      - "That's a creative prompt."

  - name: medium
    priority: 200
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: turn_quality_score
          operator: greater_than_or_equal_to
          value: 3
    min_value: 50
    max_value: 69
    mean_value: 55
    high_min_value: 500
    high_max_value: 5000
    high_mean_value: 2500
    comments:
      - "Thanks for your input on model responses."
      - "Keep engaging for more rewards."

  - name: low
    priority: 100
    is_active: true
    is_default: true
    action_type: TURN
    conditions:
      all:
        - name: turn_quality_score
          operator: greater_than_or_equal_to
          value: 0
    min_value: 20
    max_value: 39
    mean_value: 25
    high_min_value: 100
    high_max_value: 149
    high_mean_value: 120
    comments:
      - "Thank you for participating."

  - name: over_point_limit_last_month_low_reward
    priority: 400
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_month
          operator: greater_than
          value: *monthly_points_limit
    min_value: 0
    max_value: 20
    mean_value: 0
    comments:
      - "Thank you for participating."

  - name: over_point_limit_last_week_low_reward
    priority: 500
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_week
          operator: greater_than
          value: *weekly_points_limit
    min_value: 0
    max_value: 20
    mean_value: 0
    comments:
      - "Thank you for participating."

  - name: over_point_limit_last_24_hours_low_reward
    priority: 500
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_day
          operator: greater_than
          value: *daily_points_limit
    min_value: 0
    max_value: 20
    mean_value: 0
    comments:
      - "Thank you for participating."

  - name: under_point_limits_feedback_reward
    priority: 100
    is_active: true
    is_default: true
    action_type: FEEDBACK
    conditions:
      all:
        - name: points_last_day
          operator: less_than
          value: *daily_points_limit
        - name: points_last_week
          operator: less_than
          value: *weekly_points_limit
        - name: points_last_month
          operator: less_than
          value: *monthly_points_limit
    min_value: 100
    max_value: 500
    mean_value: 300
    comments:
      - "Thank you for your feedback."

  - name: under_point_limits_qt_eval_reward
    priority: 100
    is_active: true
    is_default: true
    action_type: QT_EVAL
    conditions:
      all:
        - name: points_last_day
          operator: less_than
          value: *daily_points_limit
        - name: points_last_week
          operator: less_than
          value: *weekly_points_limit
        - name: points_last_month
          operator: less_than
          value: *monthly_points_limit
    min_value: 400
    max_value: 800
    mean_value: 600
    comments:
      - "Thank you. Your feedback makes this AI serve you better!"

  - name: base_sign_up_reward
    priority: 100
    is_active: true
    is_default: true
    action_type: SIGN_UP
    conditions:
      all:
        - name: sign_up_reward_count
          operator: greater_than_or_equal_to
          value: 0
    min_value: 1000
    max_value: 1200
    mean_value: 1100

probability_rules:
  - name: under_point_limits_feedback_reward
    priority: 100
    is_active: true
    action_type: FEEDBACK
    conditions:
      all:
        - name: points_last_day
          operator: less_than
          value: *daily_points_limit
        - name: points_last_week
          operator: less_than
          value: *weekly_points_limit
        - name: points_last_month
          operator: less_than
          value: *monthly_points_limit
    probability: 1.0

  - name: no_feedback_reward
    priority: 0
    is_active: true
    is_default: true
    action_type: FEEDBACK
    conditions:
      all:
        - name: points_last_day
          operator: greater_than_or_equal_to
          value: 0
    probability: 0.0

  - name: under_point_limits_qt_eval_reward
    priority: 100
    is_active: true
    action_type: QT_EVAL
    conditions:
      all:
        - name: points_last_day
          operator: less_than
          value: *daily_points_limit
        - name: points_last_week
          operator: less_than
          value: *weekly_points_limit
        - name: points_last_month
          operator: less_than
          value: *monthly_points_limit
    probability: 1.0

  - name: no_qt_eval_reward
    priority: 0
    is_active: true
    is_default: true
    action_type: QT_EVAL
    conditions:
      all:
        - name: points_last_day
          operator: greater_than_or_equal_to
          value: 0
    probability: 0.0

  - name: kill_switch
    priority: 100000
    is_active: false
    action_type: TURN
    conditions:
      all:
        - name: points
          operator: greater_than
          value: 0
    probability: 0.0

  - name: over_point_limit_no_reward
    priority: 1000
    is_active: true
    action_type: TURN
    conditions:
      any:
        - name: points_last_day
          operator: greater_than
          value: *daily_points_limit
        - name: points_last_week
          operator: greater_than
          value: *weekly_points_limit
        - name: points_last_month
          operator: greater_than
          value: *monthly_points_limit
    probability: 0.0

  - name: over_point_limit_last_month_low_probability
    priority: 300
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_month
          operator: greater_than
          value: *monthly_points_limit
    probability: 0.05

  - name: over_point_limit_last_week_low_probability
    priority: 400
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_week
          operator: greater_than
          value: *weekly_points_limit
    probability: 0.05

  - name: over_point_limit_last_24_hours_low_probability
    priority: 400
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points_last_day
          operator: greater_than
          value: *daily_points_limit
    probability: 0.05

  - name: override_switch
    priority: 399
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: points
          operator: greater_than
          value: 0
    probability: 1.0  # temporarily overriding non-abuse reward probablilties until we implement model_feedback

  - name: first_chat_eval_1
    priority: 99
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: equal_to
          value: 0
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 0
    probability: 0.9

  - name: first_chat_eval_2
    priority: 98
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: equal_to
          value: 0
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 1
    probability: 0.7

  - name: first_chat_eval_3
    priority: 97
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: equal_to
          value: 0
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 2
    probability: 0.5

  - name: first_chat_eval_4
    priority: 96
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: equal_to
          value: 0
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 3
    probability: 0.4

  - name: first_chat_eval_5
    priority: 95
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: equal_to
          value: 0
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 4
    probability: 0.3

  - name: early_chat_eval_1
    priority: 94
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: less_than
          value: 5
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 0
    probability: 0.9

  - name: early_chat_eval_2
    priority: 93
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: less_than
          value: 5
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 1
    probability: 0.8

  - name: early_chat_eval_3
    priority: 92
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: less_than
          value: 5
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 2
    probability: 0.8

  - name: early_chat_eval_4
    priority: 91
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: less_than
          value: 5
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 3
    probability: 0.7

  - name: early_chat_eval_5
    priority: 90
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: previous_chat_count
          operator: less_than
          value: 5
        - name: previous_eval_count_in_chat
          operator: equal_to
          value: 4
    probability: 0.7

  - name: prompt_not_safe
    priority: 350
    is_active: true
    action_type: TURN
    conditions:
      all:
        - name: turn_quality_score
          operator: equal_to
          value: 0
    probability: 0.0

  - name: active_user
    priority: 0
    is_active: true
    is_default: true
    action_type: TURN
    conditions:
      all:
        - name: credits
          operator: greater_than
          value: 0
    probability: 0.5  # can increase this in staging for testing purposes

  - name: base_sign_up_reward
    priority: 100
    is_active: true
    action_type: SIGN_UP
    conditions:
      all:
        - name: sign_up_reward_count
          operator: equal_to
          value: 0
    probability: 1

  - name: no_duplicate_sign_up_reward
    priority: 0
    is_active: true
    is_default: true
    action_type: SIGN_UP
    conditions:
      all:
        - name: sign_up_reward_count
          operator: greater_than
          value: 0
    probability: 0.0
